<div class="qd-shop-admin-orders-page">
  {{! é¡µé¢å¤´éƒ¨ }}
  <div class="qd-admin-orders-header">
    <div class="qd-admin-orders-title">
      <button class="back-btn" {{on "click" this.goBackToShop}}>
        <i class="fa fa-arrow-left"></i>
      </button>
      <h1>ğŸ› ï¸ è®¢å•ç®¡ç†</h1>
      <p class="qd-admin-orders-subtitle">ç®¡ç†æ‰€æœ‰ç”¨æˆ·çš„è´­ä¹°è®¢å•</p>
    </div>
    
    <div class="qd-admin-orders-actions">
      <button 
        class="btn btn-default refresh-btn {{if this.isLoading 'loading'}}" 
        {{on "click" this.refreshOrders}}
        disabled={{this.isLoading}}
      >
        <i class="fa fa-refresh {{if this.isLoading 'fa-spin'}}"></i>
        {{if this.isLoading "åˆ·æ–°ä¸­..." "åˆ·æ–°"}}
      </button>
    </div>
  </div>

  {{! ç»Ÿè®¡é¢æ¿ - å¯ç‚¹å‡»ç­›é€‰ }}
  <div class="qd-admin-stats">
    <div class="stats-item {{if (eq this.currentFilter 'all') 'active'}}" {{on "click" (fn this.setFilter "all")}}>
      <span class="stats-label">æ€»è®¢å•æ•°</span>
      <span class="stats-value">{{this.orderStats.total}}</span>
    </div>
    <div class="stats-item pending {{if (eq this.currentFilter 'pending') 'active'}}" {{on "click" (fn this.setFilter "pending")}}>
      <span class="stats-label">å¤„ç†ä¸­</span>
      <span class="stats-value">{{this.orderStats.pending}}</span>
    </div>
    <div class="stats-item completed {{if (eq this.currentFilter 'completed') 'active'}}" {{on "click" (fn this.setFilter "completed")}}>
      <span class="stats-label">å·²å®Œæˆ</span>
      <span class="stats-value">{{this.orderStats.completed}}</span>
    </div>
    <div class="stats-item cancelled {{if (eq this.currentFilter 'cancelled') 'active'}}" {{on "click" (fn this.setFilter "cancelled")}}>
      <span class="stats-label">å·²å–æ¶ˆ</span>
      <span class="stats-value">{{this.orderStats.cancelled}}</span>
    </div>
  </div>

  {{! è®¢å•åˆ—è¡¨ }}
  <div class="qd-admin-orders-content">
    {{#if this.paginatedOrders.length}}
      <div class="qd-admin-orders-list">
        {{#each this.paginatedOrders as |order|}}
          <div class="qd-admin-order-card">
            <div class="order-header">
              <div class="order-id">
                <span class="order-label">è®¢å•å·:</span>
                <span class="order-number">#{{order.id}}</span>
              </div>
              <div class="order-status">
                <span class="status-badge {{this.getStatusClass order.status}}">
                  {{this.getStatusText order.status}}
                </span>
                <div class="order-actions">
                  <button 
                    class="btn btn-small update-status-btn" 
                    {{on "click" (action "showUpdateStatusModal" order)}}
                  >
                    <i class="fa fa-edit"></i>
                    æ›´æ–°çŠ¶æ€
                  </button>
                  <button 
                    class="btn btn-small btn-danger delete-order-btn" 
                    {{on "click" (action "deleteOrder" order)}}
                  >
                    <i class="fa fa-trash"></i>
                    åˆ é™¤
                  </button>
                </div>
              </div>
            </div>
            
            <div class="order-body">
              <div class="user-info">
                <div class="user-avatar">
                  <img src="{{this.getUserAvatar order.user_avatar}}" alt="{{order.username}}">
                </div>
                <div class="user-details">
                  <h4 class="username">{{order.username}}</h4>
                  <span class="user-id">ID: {{order.user_id}}</span>
                </div>
              </div>
              
              <div class="product-info">
                <div class="product-icon">
                  <i class="fa {{order.product_icon}}"></i>
                </div>
                <div class="product-details">
                  <h4 class="product-name">{{order.product_name}}</h4>
                  <p class="product-description">{{order.product_description}}</p>
                </div>
              </div>
              
              <div class="order-details">
                <div class="detail-row">
                  <span class="detail-label">å•†å“ID:</span>
                  <span class="detail-value">{{order.product_id}}</span>
                </div>
              </div>
              
              {{! ä»·æ ¼å’Œå¤‡æ³¨ä¿¡æ¯åŒºåŸŸ }}
              <div class="price-notes-section">
                <div class="price-info">
                  <div class="price-row">
                    <span class="price-label">æ•°é‡:</span>
                    <span class="price-value">{{order.quantity}} ä»¶</span>
                  </div>
                  <div class="price-row">
                    <span class="price-label">å•ä»·:</span>
                    <span class="price-value">{{order.unit_price}} ç§¯åˆ†</span>
                  </div>
                  <div class="price-row total-price">
                    <span class="price-label">æ€»ä»·:</span>
                    <span class="price-value">{{order.total_price}} ç§¯åˆ†</span>
                  </div>
                </div>
                
                {{#if order.notes}}
                  <div class="notes-info">
                    <span class="notes-label">ç®¡ç†å‘˜å¤‡æ³¨</span>
                    <div class="notes-content">{{order.notes}}</div>
                  </div>
                {{/if}}
              </div>
            </div>
            
            <div class="order-footer">
              <div class="order-time">
                <span class="time-label">åˆ›å»ºæ—¶é—´:</span>
                <span class="time-value">{{this.formatDate order.created_at}}</span>
              </div>
              {{#if order.updated_at}}
                <div class="order-time">
                  <span class="time-label">æ›´æ–°æ—¶é—´:</span>
                  <span class="time-value">{{this.formatDate order.updated_at}}</span>
                </div>
              {{/if}}
            </div>
          </div>
        {{/each}}
      </div>

      {{! åˆ†é¡µæ§ä»¶ }}
      {{#if this.hasMultiplePages}}
        <div class="qd-pagination">
          <button 
            class="btn btn-small pagination-btn" 
            {{on "click" this.previousPage}}
            disabled={{not this.hasPreviousPage}}
          >
            <i class="fa fa-chevron-left"></i>
            ä¸Šä¸€é¡µ
          </button>
          
          <div class="pagination-info">
            ç¬¬ {{this.currentPage}} é¡µï¼Œå…± {{this.totalPages}} é¡µ
            (æ˜¾ç¤º {{this.paginatedOrders.length}} / {{this.filteredOrders.length}} æ¡è®°å½•)
          </div>
          
          <button 
            class="btn btn-small pagination-btn" 
            {{on "click" this.nextPage}}
            disabled={{not this.hasNextPage}}
          >
            ä¸‹ä¸€é¡µ
            <i class="fa fa-chevron-right"></i>
          </button>
        </div>
      {{/if}}
    {{else}}
      <div class="qd-empty-state">
        <div class="empty-icon">
          <i class="fa fa-inbox"></i>
        </div>
        <h3>{{#if (eq this.currentFilter "all")}}æš‚æ— è®¢å•{{else}}æš‚æ— {{this.getStatusText this.currentFilter}}è®¢å•{{/if}}</h3>
        <p>{{#if (eq this.currentFilter "all")}}è¿˜æ²¡æœ‰ç”¨æˆ·è´­ä¹°å•†å“{{else}}ç‚¹å‡»å…¶ä»–çŠ¶æ€æŸ¥çœ‹æ›´å¤šè®¢å•{{/if}}</p>
      </div>
    {{/if}}
  </div>

  {{! æ›´æ–°çŠ¶æ€å¼¹çª— }}
  {{#if this.showStatusModal}}
    <div class="qd-modal-overlay" {{on "click" this.closeStatusModal}}>
      <div class="qd-modal-container qd-update-order-modal" {{on "click" this.stopPropagation}}>
        <div class="qd-modal-header">
          <h3><i class="fa fa-edit"></i> æ›´æ–°è®¢å•çŠ¶æ€</h3>
          <button class="qd-modal-close" {{on "click" this.closeStatusModal}}>
            <i class="fa fa-times"></i>
          </button>
        </div>

        <div class="qd-modal-body">
          {{#if this.selectedOrder}}
            <div class="qd-order-summary">
              <div class="qd-summary-row">
                <span class="qd-summary-label">è®¢å•å·:</span>
                <span class="qd-summary-value">#{{this.selectedOrder.id}}</span>
              </div>
              <div class="qd-summary-row">
                <span class="qd-summary-label">ç”¨æˆ·:</span>
                <span class="qd-summary-value">{{this.selectedOrder.username}}</span>
              </div>
              <div class="qd-summary-row">
                <span class="qd-summary-label">å•†å“:</span>
                <span class="qd-summary-value">{{this.selectedOrder.product_name}}</span>
              </div>
              <div class="qd-summary-row">
                <span class="qd-summary-label">æ•°é‡:</span>
                <span class="qd-summary-value">{{this.selectedOrder.quantity}} ä»¶</span>
              </div>
              <div class="qd-summary-row">
                <span class="qd-summary-label">å•ä»·:</span>
                <span class="qd-summary-value">{{this.selectedOrder.unit_price}} ç§¯åˆ†</span>
              </div>
              <div class="qd-summary-row">
                <span class="qd-summary-label">æ€»ä»·:</span>
                <span class="qd-summary-value qd-total-highlight">{{this.selectedOrder.total_price}} ç§¯åˆ†</span>
              </div>
            </div>

            <div class="qd-form-group">
              <label class="qd-form-label">è®¢å•çŠ¶æ€:</label>
              <select class="qd-form-select" {{on "change" this.updateOrderStatus}}>
                <option value="pending" selected={{eq this.selectedOrder.status "pending"}}>å¤„ç†ä¸­</option>
                <option value="completed" selected={{eq this.selectedOrder.status "completed"}}>å·²å®Œæˆ</option>
                <option value="cancelled" selected={{eq this.selectedOrder.status "cancelled"}}>å·²å–æ¶ˆ</option>
              </select>
            </div>

            <div class="qd-form-group">
              <label class="qd-form-label">ç®¡ç†å‘˜å¤‡æ³¨:</label>
              <textarea 
                class="qd-form-textarea" 
                placeholder="å¯é€‰çš„ç®¡ç†å‘˜å¤‡æ³¨..."
                {{on "input" this.updateAdminNotes}}
              >{{this.adminNotes}}</textarea>
            </div>

            {{#if this.statusMessage}}
              <div class="qd-status-message {{if (includes this.statusMessage 'æˆåŠŸ') 'success' 'error'}}">
                {{this.statusMessage}}
              </div>
            {{/if}}
          {{/if}}
        </div>

        <div class="qd-modal-footer">
          <button class="btn btn-default" {{on "click" this.closeStatusModal}}>
            <i class="fa fa-times"></i> å–æ¶ˆ
          </button>
          <button 
            class="btn btn-primary qd-confirm-btn" 
            {{on "click" this.confirmUpdateOrder}}
            disabled={{this.isLoading}}
          >
            {{#if this.isLoading}}
              <i class="fa fa-spinner fa-spin"></i> æ›´æ–°ä¸­...
            {{else}}
              <i class="fa fa-check"></i> ç¡®è®¤æ›´æ–°
            {{/if}}
          </button>
        </div>
      </div>
    </div>
  {{/if}}
</div>